<p align="center">
  <img src="FRBCanVis_Logo.png" alt="FRBCanVis Logo" width="300"/>
</p>

# FRBCanVis: Fast Radio Burst Candidate Visualiser

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/release/python-390/)
[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)
[![cyclopts](https://img.shields.io/badge/built%20with-cyclopts-blue.svg)](https://github.com/BrianPugh/cyclopts)

This repository contains the code to plot the fast radio burst (FRB) candidates generated by the transient search pipeline of the SPOTLIGHT project.

## About SPOTLIGHT

SPOTLIGHT (Search for Pulsars and Transients with uGMRT Low-frequency Telescope) is a project aimed at discovering new pulsars and fast radio bursts.

## Links

- **SPOTLIGHT Project Website:** [https://spotlight.ncra.tifr.res.in/](https://spotlight.ncra.tifr.res.in/)
- **SPOTLIGHT GitHub Repository:** [https://github.com/nsmspotlight](https://github.com/nsmspotlight)

## Usage

The `can_visualiser.py` script provides two main commands:

- `find`: To find and plot all candidates from a `classification_results.csv` file.
- `see`: To plot a single, specific candidate by providing its direct path information.

### `find` Command

This is the default command for batch processing all candidates listed in the pipeline's output CSV.

**Option 1: By providing the observation directory (recommended):**

```bash
python can_visualiser.py find -o <observation_directory_name>
```

**Option 2: By providing the full paths to the data files:**

```bash
python can_visualiser.py find -c <path_to_csv_file> -d <path_to_data_dir>
```

### `see` Command

This command is for quickly visualizing a single candidate by providing the direct path to its `.h5` file.

```bash
python can_visualiser.py see -c <path_to_candidate_file.h5>
```

### Arguments

#### `find` Arguments

- `-o`, `--obs-dir`: Name of the observation directory. If provided, `--csv-file` and `--data-dir` are not needed.
- `-c`, `--csv-file`: Path to the `classification_results.csv` file. Required if `-o` is not provided.
- `-d`, `--data-dir`: Path to the root `FRBPipeData` directory, which contains the `BMxx` subdirectories. Required if `-o` is not provided.
- `-z`, `--zoom`: (Optional) If specified, the script will zoom in on the central part of the plots.

#### `see` Arguments

- `-c`, `--cand-file`: The full path to the candidate's `.h5` file. The candidate name, beam, and data directory are inferred from this path.
- `-z`, `--zoom`: (Optional) If specified, the script will zoom in on the central part of the plots.

## Dependencies

The script requires the following Python packages:

- pandas
- matplotlib
- h5py
- rich
- cyclopts

You can install them using pip:

```bash
pip install pandas matplotlib h5py rich cyclopts
```

## Output

The script generates a PNG image for each candidate. Each image contains three subplots:

1. **Top Panel:** The mean pulse profile across all frequency channels.
2. **Bottom-Left Panel:** The frequency-time dynamic spectrum.
3. **Bottom-Right Panel:** The DM-time plot, i.e., the DM transform.

The location and the filename of the output image depends on the command used:

- **`find` command:** `<data_dir>/Triggered_candidates/<index>_<candidate_id>_<zoom_status>.png`
- **`see` command:** `$(dirname <cand_file>)/<candidate_name>_<zoom_status>.png`

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.
